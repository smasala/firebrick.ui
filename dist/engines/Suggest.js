/*!
 * @author Steven Masala [me@smasala.com]
 */

define(["jquery","firebrick"],function(e){return Firebrick.define("Firebrick.ui.engines.Suggest",{store:null,mode:"local",_cache:null,searchKeys:null,prefetch:null,init:function(){var e=this;e._initCache()},_initCache:function(){var e=this;e._cache={}},clear:function(){me._initCache()},filter:function(){return!0},query:function(e,t){var n=this,r=[],i,s;n.store&&(n.mode==="remote"?n.store.load({suggest:{query:e},callback:function(i){r=n._query(e,n.store.toPlainObject()),t(r)}}):n.mode==="local"&&(n._cache[e]?(i=n._cache[e],r=n._cache[e].filter(function(){return n.filter.apply(n,arguments)})):(r=n._query(e,n.store.toPlainObject()),n._cache[e]=r),t(r)))},_query:function(t,n){var r=this,i=[],s,o,u=new RegExp(t,"i"),a;for(var f=0,l=n.length;f<l;f++){a=n[f];if(r.filter(a)){s=r._getSearchStrings(a);for(var c=0,h=s.length;c<h;c++){o=s[c],o=e.isFunction(o)?o():o;if(u.test(o)){i.push(a);break}}}}return i},_getSearchStrings:function(t){var n=this,r=n.searchKeys,i=[],s;if(e.isPlainObject(t))if(r)if(e.isArray(r))for(var o=0,u=r.length;o<u;o++)s=r[o],t.hasOwnProperty(s)&&i.push(t[s]);else t.hasOwnProperty(r)&&i.push(t[r]);else for(var a in t)t.hasOwnProperty(a)&&i.push(t[a]);else i.push(t);return i}})});