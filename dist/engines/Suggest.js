/*!
 * @author Steven Masala [me@smasala.com]
 */

define(["jquery","firebrick"],function(e){"use strict";return Firebrick.define("Firebrick.ui.engines.Suggest",{store:null,mode:"local",_cache:null,searchKeys:null,prefetch:null,init:function(){var e=this;e._initCache()},_initCache:function(){var e=this;e._cache={}},clear:function(){var e=this;e._initCache()},filter:function(){return!0},query:function(e,t){var n=this,r=[],i;n.store&&(n.mode==="remote"?n.store.load({suggest:{query:e},callback:function(){r=n._query(e,n.store.toPlainObject()),t(r)}}):n.mode==="local"&&(n._cache[e]?(i=n._cache[e],r=n._cache[e].filter(function(){return n.filter.apply(n,arguments)})):(r=n._query(e,n.store.toPlainObject()),n._cache[e]=r),t(r)))},_query:function(t,n){var r=this,i=[],s=[],o,u,a,f=new RegExp(t,"i"),l;for(var c=0,h=n.length;c<h;c++){l=n[c];if(r.filter(l)&&l.exclude!==!0){if(l.suggestable!==!1){u=r._getSearchStrings(l);for(var p=0,d=u.length;p<d;p++){a=u[p],a=e.isFunction(a)?a():a;if(f.test(a)){i.push(l);break}}}e.isArray(l.children)&&(s=r._query(t,l.children),s.length&&(o=Firebrick.utils.copyover({},l),o.children=s,i.push(o)))}}return i},_getSearchStrings:function(t){var n=this,r=n.searchKeys,i=[],s;if(e.isPlainObject(t))if(r)if(e.isArray(r))for(var o=0,u=r.length;o<u;o++)s=r[o],t.hasOwnProperty(s)&&i.push(t[s]);else t.hasOwnProperty(r)&&i.push(t[r]);else for(var a in t)t.hasOwnProperty(a)&&i.push(t[a]);else i.push(t);return i}})});