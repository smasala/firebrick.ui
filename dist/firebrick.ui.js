/*!
* Firebrick UI
* @author Steven Masala [me@smasala.com]
* 
* FirebrickUI, component library for Firebrick JS
**/

(function(e,t){if(typeof define!="function"||!define.amd)return t(e.jQuery,e.Firebrick,e.ko);define(["jquery","firebrick","knockout","knockout-mapping","text"],function(e,n,r,i,s,o){return r.mapping=i,t(e,n,r,o)})})(this,function(e,t,n){if(!t){console.error("Firebrick has not been loaded, Firebrick-UI requires Firebrick JS to function");return}if(t.ui){console.error("Firebrick.ui namespace has already been taken!");return}t.ui={version:"0.11.0",_searchCache:{},_componentCache:{},build:function(e){var n=this,r=t.views.getTarget(e.target),i,s;return i=n._populate(e.items,e.view),s=i.html,e.view&&i.items.length&&(e.view.items=i.items),r&&r.append(s),s},cmp:{},_populate:function(t,n){var r=this,i=[],s="",o;e.isFunction(t)&&(t=t());for(var u=0,a=t.length;u<a;u++)o=r._buildComponent(t[u],n),s+=o.html,o.getId||console.error("something went wrong",t[u],"is it defined correctly? Check the item name and dependency include"),r._componentCache[o.getId()]=o,i.push(o);return{html:s,items:i}},_buildComponent:function(e,n){var r=this,i,s;return e.isView?(e._state!=="initial"&&(i=e.init()),i=e):e.viewName?i=t.create(e.viewName,e):(e=r._componentFilter(e),e.uiComponent?i=e:(s=r.getByShortName(e.uiName||e),s||console.error("Has",e.uiName||e,"been added as a dependency?"),i=t.create(s._classname,e.uiName?Object.getPrototypeOf(Object.create(e)):null))),i._parent||(i._parent=n),i.build&&(i.html=i.build()),r._componentCache[n.getId()]||(r._componentCache[n.getId()]=n),i},_componentFilter:function(e){if(typeof e=="string")switch(e){case"|":e="fb-ui-divider"}return e},getByShortName:function(e){var n=this,r=n._searchCache[e];if(!r){var i,s;for(i in t.classes.classRegistry)if(t.classes.classRegistry.hasOwnProperty(i)){s=t.classes.classRegistry[i];if(s.uiComponent&&s.uiName===e){r=s,n._searchCache[e]=s;break}}}return r||console.error("ui component",e,"not found"),r},getCmp:function(e){return this._componentCache[e]},get:function(e){return t.get(e)},utils:{stringify:function(t){if(t){var n=function(t,r){var i=r?"":"{",s,o;for(s in t)t.hasOwnProperty(s)&&(o=t[s],e.isPlainObject(o)?i+=s+":"+n(o):i+=s+": "+o+",");return i=i.substr(-1)===","?i.substring(0,i.length-1):i,i+=r?"":"},",i};return n(t,!0)}return""}},renderer:{_registry:{},add:function(e,t){var n=this;return n._registry[e]=t,n},get:function(t){var n=this;return e.isFunction(t)&&(t=t()),n._registry[t]}}},t.classes.overwrite("Firebrick.view.Base",{listeners:{rendered:function(){var t=this;if(e.isArray(t.items))for(var n=0,r=t.items.length;n<r;n++)t.items[n].fireEvent("rendered")}},items:null,tpl:function(){var e=this;if(e.items)return t.ui.build({items:e.items,view:e})}}),n.bindingHandlers.withProperties={init:function(e,t,r,i,s){var o=s.createChildContext(s.$rawData,null,function(e){n.utils.extend(e,t())});return n.applyBindingsToDescendants(o,e),{controlsDescendantBindings:!0}}}});