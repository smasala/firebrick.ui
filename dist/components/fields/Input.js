/*!
 * @author Steven Masala [me@smasala.com]
 */

define(["knockout","text!./Base.html","text!./Input.html","./Base","../common/mixins/Items","./plugins/InplaceEdit"],function(e,t,n){return Firebrick.define("Firebrick.ui.fields.Input",{extend:"Firebrick.ui.fields.Base",mixins:["Firebrick.ui.common.mixins.Items"],sName:"fields.input",subTpl:n,type:"text",label:"",containerCSS:"",value:null,tpl:t,formGroupClass:"form-group",formControlClass:"form-control",labelWidth:3,inputWidth:9,srOnly:!1,readOnly:!1,disabled:!1,columnSize:"md",inputSize:"md",controlLabel:!0,helpText:!1,helpBlockClass:"help-block",placeholder:"",showStateIcon:!1,formControlFeedbackClass:"form-control-feedback",inputAddon:!1,inputAddonClass:"input-group-addon",inputAddonSpanClass:"",horizontal:!0,feedbackSuccess:!1,feedbackWarning:!1,feedbackError:!1,multiplesInline:!1,inplaceEdit:!1,showInplaceTitle:!0,required:!1,name:"",inputAddonPosition:"left",_inputAddonTplId:null,iconClass:!1,_lastValue:null,navbarItem:!1,init:function(){var e=this;return e.on("rendered",function(){var t;e.inplaceEdit&&(t={fieldItem:e,showInplaceTitle:!0},$.isPlainObject(e.inplaceEdit)&&(t=Firebrick.utils.overwrite(t,e.inplaceEdit)),Firebrick.create("Firebrick.ui.fields.plugins.InplaceEdit",t)),e.required&&e.onChange()}),e.callParent(arguments)},onChange:function(){var e=this,t=e.getElement(),n;e.required&&t&&t.length&&t.change(function(){n=t.closest(".form-group"),n.length&&(t.is(":invalid")?e.setStatus("error",n):e.setStatus("success",n))})},setStatus:function(e,t){var n=this,r=t||n.getElement();return r&&r.length&&e&&(r.attr("class",function(e,t){return t=t.replace(/(^|\s)has-\S+/g,""),t+=" has-feedback",t}),r.addClass("has-"+e)),n},containerBindings:function(){var e=this,t={css:{"'has-success'":e.feedbackSuccess,"'has-warning'":e.feedbackWarning,"'has-error'":e.feedbackError,"'has-feedback'":e.feedbackSuccess||e.feedbackWarning||e.feedbackError,"'sr-only'":e.srOnly}};return e.containerCSS&&(t.css[e.parseBind(e.containerCSS)]=!0),e.align&&(t.css[e.parseBind("pull-"+e.align)]=!0),e.inputSize&&(t.css[e.parseBind("form-group-"+e.inputSize)]=e.inputSize?!0:!1),e.navbarItem&&(t.css["'fb-ui-navbar-field'"]=!0),t},helpBlockBindings:function(){var e=this;return{text:e.textBind(e.helpText)}},feedbackBindings:function(){var e=this,t={css:{}},n="'glyphicon-";return e.containerBindings&&e.containerBindings.css&&$.each(e.containerBindings.css,function(e,r){if(r)switch(e){case"'has-success'":t.css[n+"ok'"]=r;break;case"'has-warning'":t.css[n+"warning'"]=r;break;case"'has-error'":t.css[n+"remove'"]=r}}),t},bindings:function(){var e=this,t=e.parseBind(e.type),n=e.callParent(arguments);return n.attr.disabled=e.disabled,n.attr.readonly=e.readOnly,n.attr.type=t,n.attr.name=e.name?e.parseBind(e.name):t,n.value=e.value,e.inplaceEdit?(n.css["'fb-ui-inplaceedit'"]=!0,n.text=e.value):(e.formControlClass&&(n.css[e.parseBind(e.formControlClass)]=!0),n.attr.placeholder=e.textBind(e.placeholder)),e.required&&(n.attr.required=!0),e.inputSize&&(n.css[e.parseBind("input-"+e.inputSize)]=!0),n},inputAddonBindings:function(){var e=this,t={css:{}};return e.inputAddon&&($.isPlainObject(e.inputAddon)&&e.inputAddon.sName==="button.button"&&(e.inputAddonClass=e.inputAddonClass.replace("input-group-addon",""),e.inputAddonClass+=" input-group-btn"),t.css[e.parseBind(e.inputAddonClass)]=!0),t},inputAddonSpanBindings:function(){var e=this,t={css:{}};return e.inputAddon&&typeof e.inputAddon=="string"&&(t.text=e.textBind(e.inputAddon)),t.css[e.parseBind(e.glyphiconClass)]=!0,e.iconClass&&(t.css[e.parseBind(e.iconClass)]=!0),t},inputAddonTemplateBindings:function(){var e=this,t={template:e.parseBind(e.getAddonId()),data:"$data"};return t},getAddonId:function(){var e=this;return e._inputAddonTplId||(e._inputAddonTplId="fb-inputaddon-"+Firebrick.utils.uniqId()),e._inputAddonTplId},labelBindings:function(){var e=this,t={text:e.textBind(e.label),css:{"'control-label'":e.controlLabel}};return e.horizontal&&(t.css[e.parseBind("col-"+e.columnSize+"-"+e.labelWidth)]=e.horizontal),t},inputContainerBindings:function(){var e=this,t={css:{}};return e.horizontal&&(t.css[e.parseBind("col-"+e.columnSize+"-"+e.inputWidth)]=e.horizontal),t},fieldBindings:function(){var e=this,t={css:{"'input-group'":e.inputAddon?!0:!1}};return e.align&&(t.css[e.parseBind("pull-"+e.align)]=!0),t},getValue:function(){var t=this;return e.utils.unwrapObservable(t._ko.value.valueAccessor())},setValue:function(e){var t=this,n=t.getValue(),r;return t._lastValue=n,t._setValue(e),r=t.getValue(),t._checkChange(r,n),t},_checkChange:function(e,t,n){var r=this;return r._hasChange(e,t)?(n||r.fireEvent("changed",e,t),!0):!1},_hasChange:function(e,t){return e!==t},_setValue:function(e){var t=this;return t._ko.value.valueAccessor()(e),t}})});