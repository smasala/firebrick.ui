/*!
 * @author Steven Masala [me@smasala.com]
 */

define(["knockout-mapping","jquery","text!./Table.html","../common/Base","datatables","responsive-tables-js","./plugins/EditableTable"],function(e,t,n){return Firebrick.define("Firebrick.ui.table.Table",{extend:"Firebrick.ui.common.Base",sName:"table.table",tpl:n,responsiveClass:!0,responsive:!0,editType:"row",columns:null,tdSpanClass:"fb-ui-tablecell-data",tableStriped:!0,tableHover:!0,tableCondensed:!1,tableBordered:!1,showHeadings:!0,showRows:!0,datatable:!1,treetable:!1,editabletable:!1,dataTableConfig:function(){return{language:{paginate:{first:"First",last:"Last",next:"Next",previous:"Previous"}}}},expandable:!0,showCaption:!0,expandText:"Expand",collapseText:"Collapse",showOptions:!0,editModalConfig:null,treeTableConfig:function(){var e=this;return{expandable:e.expandable,expanderTemplate:'<a class="glyphicon" href="javascript:void();">&nbsp;</a>'}},init:function(){var n=this;n.data=e.fromJS(n.data),n.on("rendered",function(){var e=n.getId(),r=n.getElement();n.datatable&&r.DataTable(n.dataTableConfig()),n.editabletable&&r.EditableTable(),n.treetable&&(n.showOptions&&(t("a#fb-expand-"+e).on("click",n.generateOnclick("expandAll")),t("a#fb-collapse-"+e).on("click",n.generateOnclick("collapseAll"))),r.treetable(n.treeTableConfig())),n.responsive&&window.responsiveTables&&window.responsiveTables.update(e)}),n.callParent(arguments)},containerBindings:function(){var e=this;return{css:{"'responsive'":e.responsiveClass}}},_getData:function(){var e=this;return e.store&&e.store.isStore?"Firebrick.ui.getCmp('"+e.getId()+"').getData()":{}},bindings:function(){var e=this,t=e.callParent(arguments);return t["with"]=e._getData(),t.css.table=!0,t.css["'table-striped'"]=e.tableStriped,t.css["'table-hover'"]=e.tableHover,t.css["'table-condensed'"]=e.tableCondensed,t.css["'table-bordered'"]=e.tableBordered,t.css["'responsive'"]=e.responsive,t},theadBindings:function(){var e=this,t={"if":!1};return e.columns&&(t["if"]=!0),t},theadTRBindings:function(){return{foreach:"Firebrick.getById('"+this.getId()+"').columns"}},theadTRTDBindings:function(){return{html:"$data.renderer ? fb.ui.renderer.get($data.renderer)($data, $context, $parent, $root) : ($data.text ? $data.text : $data)"}},tbodyBindings:function(){return{foreach:"$data"}},tbodyTRBindings:function(){return{foreach:"$data.row ? $data.row : $data",attr:{"'data-tt-id'":"$data.id ? $data.id : $index","'data-tt-parent-id'":"$data.parentId ? $data.parentId : false"}}},tbodyTRTDBindings:function(){return{attr:{"'data-tt-id'":"$data.id ? $data.id : $index","'fb-ui-row-id'":"$data.rowId ? $data.rowId : $parentContext.$index"}}},tbodyTRTDSpanBindings:function(){var e=this,t={css:{},html:"$data.renderer ? fb.ui.renderer.get($data.renderer)($data, $context, $parent, $root) : ($data.value ? $data.value : $data)"};return t.css[e.parseBind(e.tdSpanClass)]=!0,t},captionBindings:function(){var e=this;return{show:e.showCaption}},generateOnclick:function(e){var t=this;return function(){return t.getElement().treetable(e),!1}},expandBindings:function(){var e=this;return{text:e.textBind(e.expandText),attr:{id:e.parseBind("fb-expand-"+e.getId()),href:"''"}}},collapseBindings:function(){var e=this;return{text:e.textBind(e.collapseText),attr:{id:e.parseBind("fb-collapse-"+e.getId()),href:"''"}}}})});