/*!
 * @author Steven Masala [me@smasala.com]
 */

define(["doT","firebrick"],function(e){return Firebrick.define("Firebrick.ui.common.Base",{extend:"Firebrick.view.Base",_idPrefix:"fb-ui-",id:null,uiComponent:!0,glyphiconClass:"glyphicon",_build:null,_template:null,tpl:null,subTpl:null,css:null,uiName:null,_element:null,tooltip:!1,tooltipLocation:"top",tooltipOptions:null,popover:!1,popoverTitle:!1,popoverLocation:"top",popoverOptions:null,popoverDismissible:!0,addTooltipPopoverBind:function(e){var t=this;if(t.tooltip||t.popover)if(e&&$.isPlainObject(e)){e.attr||(e.attr={}),e.attr["'data-toggle'"]=t.parseBind(t.tooltip?"tooltip":"popover");if(t.tooltip||t.popoverTitle)e.attr.title=t.textBind(t.tooltip||t.popoverTitle);t.popover&&(e.attr["'data-content'"]=t.textBind(t.popover),e.attr["'data-container'"]="'body'",t.popoverDismissible&&(e.attr["'data-trigger'"]="'focus'")),e.attr["'data-placement'"]=t.parseBind(t.tooltipLocation||t.popoverLocation)}return e},addPopoverBind:function(e){var t=this;return t.tooltip&&e&&$.isPlainObject(e)&&(e.attr||(e.attr={}),e.attr["'data-toggle'"]="'popover'",e.attr.title=t.textBind(t.popover),e.attr["'data-placement'"]=t.parseBind(t.popoverLocation)),e},getElement:function(){var e=this;return e._element||(e._element=$("#"+e.getId()),e._element.length||(e._element=null)),e._element},constructor:function(){var e=this,t=e.uiName;if(t){var n=t.substr(t.lastIndexOf("-")+1);Firebrick.ui.cmp[n]=t}return e.precompile(),e.callParent(arguments)},precompile:function(){var e=this;return e._template={},e._build={},e.tpl&&e.template(),e.subTpl&&e.template("subTpl"),e},b:function(e){return $.isFunction(e)?e.bind(this)():e},init:function(){var e=this;return e.autoRender&&e.getTarget()&&(e.tpl=e.build()),e.tooltip&&require(["bootstrap.plugins/tooltip"],function(){var t=e.getElement();t&&t.tooltip(e.tooltipOptions)}),e.popover&&require(["bootstrap.plugins/tooltip","bootstrap.plugins/popover"],function(){var t=e.getElement();t&&t.popover(e.popoverOptions)}),e.callParent(arguments)},_getCSSClasses:function(){var e=this,t={},n;if(e.css){n=e.css.split(",");if(n.length)for(var r=0,i=n.length;r<i;r++)t[e.parseBind(n[r])]=!0}return t},bindings:function(){var e=this,t={attr:{},css:e._getCSSClasses()};return e.addTooltipPopoverBind(t)},template:function(t,n){var r=this;t=t||"tpl";if(!r._template[t]||n)r._template[t]=e.template(r[t]);return r._template[t]},build:function(e){var t=this;return e=e||"tpl",t._build[e]=t._template[e](t),t._build[e]},dataBind:function(e){var t=this,n=e?t[e]:t.bindings;return $.isFunction(n)&&(n=n.call(t)),Firebrick.ui.utils.stringify(n)},getId:function(){var e=this,t=e.id;return t||(t=this.getClassId(),e.id=t),t},getSubTpl:function(){return this.build("subTpl")},_getParent:function(e){var t=e||this,n=Object.getPrototypeOf(t);if(t._classname!==n._classname)if(t.subTpl!==n.subTpl||t.tpl!==n.tpl)return n;return this._getParent(n)},getParentTpl:function(){var t=this;return e.template(t._getParent().tpl)(t)},getParentSubTpl:function(){var t=this;return e.template(t._getParent().subTpl)(t)},cleanString:function(e){return e.replace(/\'/g,"")},parseBind:function(e){return"'"+e+"'"},textBind:function(e){return"fb.text('"+e+"')"}})});