/*!
 * @author Steven Masala [me@smasala.com]
 */

define(["doT","jquery","bootstrap.plugins/tooltip","bootstrap.plugins/popover"],function(e,t){"use strict";return Firebrick.define("Firebrick.ui.common.Base",{extend:"Firebrick.view.Base",_idPrefix:"fb-ui-",uiComponent:!0,handlerEvent:"click",handler:null,autoFocus:!1,glyphiconClass:"glyphicon",_build:null,_template:null,tpl:null,subTpl:null,css:null,style:null,sName:null,_element:null,tooltip:!1,tooltipLocation:"top",tooltipOptions:null,popover:!1,popoverTitle:!1,popoverLocation:"top",popoverOptions:null,popoverDismissible:!0,align:null,contextMenu:null,beforeSubTpl:null,afterSubTpl:null,addTooltipPopoverBind:function(e){var n=this;if(n.tooltip||n.popover)if(e&&t.isPlainObject(e)){e.attr||(e.attr={}),e.attr["'data-toggle'"]=n.parseBind(n.tooltip?"tooltip":"popover");if(n.tooltip||n.popoverTitle)e.attr.title=n.textBind(n.tooltip||n.popoverTitle);n.popover&&(e.attr["'data-content'"]=n.textBind(n.popover),e.attr["'data-container'"]="'body'",n.popoverDismissible&&(e.attr["'data-trigger'"]="'focus'")),e.attr["'data-placement'"]=n.parseBind(n.tooltipLocation||n.popoverLocation)}return e},_getElementSelector:function(){var e=this,t=e.enclosedBind?e.getEnclosedBindId():e.getId();return"#"+t},getElement:function(){var e=this;return e._element||(e._element=t(e._getElementSelector()),e._element.length||(e._element=null)),e._element},constructor:function(){var e=this;return e._precompile(),e.callParent(arguments)},_precompile:function(){var e=this,t,n=["tpl","beforeSubTpl","subTpl","afterSubTpl"];e._template={},e._build={};for(var r=0,i=n.length;r<i;r++)t=n[r],e[t]&&e.template(t);return e},b:function(e){return t.isFunction(e)?e.bind(this)():e},init:function(){var e=this;return e.autoRender&&e.getTarget()&&(e.tpl=e.build()),e._registerHandler(),e.on("rendered",function(){var t=e.getElement();e._prepTooltipPopover(),e.contextMenu&&!e.contextMenu._classname&&require(["Firebrick.ui/menu/ContextMenu"],function(){t.on("contextmenu",function(t){var n={_parent:e,contextMenuEvent:t};t.preventDefault(),e._contextMenu=Firebrick.create("Firebrick.ui.menu.ContextMenu",Firebrick.utils.overwrite(n,e.contextMenu))})}),e.autoFocus&&e.focus()}),e.callParent(arguments)},_prepTooltipPopover:function(){var e=this,t,n;if(e.tooltip||e.popover)t=e.getElement(),n=t.offset(),e.tooltip&&t.tooltip(e.tooltipOptions),e.popover&&t.popover(e.popoverOptions);return e},focus:function(){this.getElement().focus()},_registerHandler:function(e,n,r){var i=this;n=n||i.handler,r=r||i.handlerEvent,e=e||i._getElementSelector(),n&&r&&t(document).on(r,e,function(){var e=Array.prototype.slice.call(arguments);e.push(this),n.apply(i,e)})},bindings:function(){var e=this,t={attr:{},css:{}};return e.css&&(t.css[e.parseBind(e.css)]=!0),e.style&&(t.style=e.style),e.addTooltipPopoverBind(t)},template:function(t,n){var r=this;t=t||"tpl";if(!r._template[t]||n)r._template[t]=e.template(r[t]);return r._template[t]},build:function(e){var t=this;return e=e||"tpl",t._build[e]=t._template[e](t),t._build[e]},dataBind:function(){var e=this,n=Firebrick.utils.argsToArray(arguments),r,i;return n&&n.length?r=n.splice(0,1):r="bindings",i=e[r],t.isFunction(i)&&(i=i.apply(e,n)),Firebrick.ui.utils.stringify(i)},getSubTpl:function(){var e=this,t=e.build("subTpl");return e.beforeSubTpl&&(t=e.build("beforeSubTpl")+t),e.afterSubTpl&&(t+=e.build("afterSubTpl")),t},_getParent:function(e){var t=e||this,n=Object.getPrototypeOf(t);if(t._classname!==n._classname)if(t.subTpl!==n.subTpl||t.tpl!==n.tpl)return n;return this._getParent(n)},getParentTpl:function(){var t=this;return e.template(t._getParent().tpl)(t)},getParentSubTpl:function(){var t=this;return e.template(t._getParent().subTpl)(t)},cleanString:function(e){return e.replace(/\'/g,"")},parseBind:function(e){return"'"+e+"'"},textBind:function(e){return"Firebrick.text('"+e+"')"}})});