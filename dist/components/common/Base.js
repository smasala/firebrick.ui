/*!
 * @author Steven Masala [me@smasala.com]
 */

define(["doT","firebrick","jquery"],function(e,t,n){return Firebrick.define("Firebrick.ui.common.Base",{extend:"Firebrick.view.Base",_idPrefix:"fb-ui-",uiComponent:!0,handlerEvent:"click",handler:null,glyphiconClass:"glyphicon",_build:null,_template:null,tpl:null,subTpl:null,css:null,style:null,sName:null,_element:null,tooltip:!1,tooltipLocation:"top",tooltipOptions:null,popover:!1,popoverTitle:!1,popoverLocation:"top",popoverOptions:null,popoverDismissible:!0,align:null,contextMenu:null,addTooltipPopoverBind:function(e){var t=this;if(t.tooltip||t.popover)if(e&&n.isPlainObject(e)){e.attr||(e.attr={}),e.attr["'data-toggle'"]=t.parseBind(t.tooltip?"tooltip":"popover");if(t.tooltip||t.popoverTitle)e.attr.title=t.textBind(t.tooltip||t.popoverTitle);t.popover&&(e.attr["'data-content'"]=t.textBind(t.popover),e.attr["'data-container'"]="'body'",t.popoverDismissible&&(e.attr["'data-trigger'"]="'focus'")),e.attr["'data-placement'"]=t.parseBind(t.tooltipLocation||t.popoverLocation)}return e},addPopoverBind:function(e){var t=this;return t.tooltip&&e&&n.isPlainObject(e)&&(e.attr||(e.attr={}),e.attr["'data-toggle'"]="'popover'",e.attr.title=t.textBind(t.popover),e.attr["'data-placement'"]=t.parseBind(t.popoverLocation)),e},_getElementSelector:function(){var e=this,t=e.enclosedBind?e.getEnclosedBindId():e.getId();return"#"+t},getElement:function(){var e=this;return e._element||(e._element=n(e._getElementSelector()),e._element.length||(e._element=null)),e._element},constructor:function(){var e=this;return e.precompile(),e.callParent(arguments)},precompile:function(){var e=this;return e._template={},e._build={},e.tpl&&e.template(),e.subTpl&&e.template("subTpl"),e},b:function(e){return n.isFunction(e)?e.bind(this)():e},init:function(){var e=this;return e.autoRender&&e.getTarget()&&(e.tpl=e.build()),e.tooltip&&require(["bootstrap.plugins/tooltip"],function(){var t=e.getElement();t&&t.tooltip(e.tooltipOptions)}),e.popover&&require(["bootstrap.plugins/tooltip","bootstrap.plugins/popover"],function(){var t=e.getElement();t&&t.popover(e.popoverOptions)}),e._registerHandler(),e.contextMenu&&!e.contextMenu._classname&&e.on("rendered",function(){var t=e.getElement();require(["Firebrick.ui/common/plugins/ContextMenu"],function(){t.on("contextmenu",function(t){var n={_parent:e,contextMenuEvent:t};t.preventDefault(),e._contextMenu=Firebrick.create("Firebrick.ui.common.plugins.ContextMenu",Firebrick.utils.overwrite(n,e.contextMenu))})})}),e.callParent(arguments)},_registerHandler:function(e,t,r){var i=this;t=t||i.handler,r=r||i.handlerEvent,e=e||i._getElementSelector(),t&&r&&n(document).on(r,i._getElementSelector(),function(){var e=Array.prototype.slice.call(arguments);e.push(this),t.apply(i,e)})},bindings:function(){var e=this,t={attr:{},css:{}};return e.css&&(t.css[e.parseBind(e.css)]=!0),e.style&&(t.style=e.style),e.addTooltipPopoverBind(t)},template:function(t,n){var r=this;t=t||"tpl";if(!r._template[t]||n)r._template[t]=e.template(r[t]);return r._template[t]},build:function(e){var t=this;return e=e||"tpl",t._build[e]=t._template[e](t),t._build[e]},dataBind:function(e){var t=this,r=e?t[e]:t.bindings;return n.isFunction(r)&&(r=r.call(t)),Firebrick.ui.utils.stringify(r)},getSubTpl:function(){return this.build("subTpl")},_getParent:function(e){var t=e||this,n=Object.getPrototypeOf(t);if(t._classname!==n._classname)if(t.subTpl!==n.subTpl||t.tpl!==n.tpl)return n;return this._getParent(n)},getParentTpl:function(){var t=this;return e.template(t._getParent().tpl)(t)},getParentSubTpl:function(){var t=this;return e.template(t._getParent().subTpl)(t)},cleanString:function(e){return e.replace(/\'/g,"")},parseBind:function(e){return"'"+e+"'"},textBind:function(e){return"fb.text('"+e+"')"}})});