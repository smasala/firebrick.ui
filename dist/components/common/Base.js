/*!
 * @author Steven Masala [me@smasala.com]
 */

define(["doT","firebrick","jquery"],function(e,t,n){return Firebrick.define("Firebrick.ui.common.Base",{extend:"Firebrick.view.Base",_idPrefix:"fb-ui-",uiComponent:!0,handlerEvent:"click",handler:null,autoFocus:!1,glyphiconClass:"glyphicon",_build:null,_template:null,tpl:null,subTpl:null,css:null,style:null,sName:null,_element:null,tooltip:!1,tooltipLocation:"top",tooltipOptions:null,popover:!1,popoverTitle:!1,popoverLocation:"top",popoverOptions:null,popoverDismissible:!0,align:null,contextMenu:null,beforeSubTpl:null,afterSubTpl:null,addTooltipPopoverBind:function(e){var t=this;if(t.tooltip||t.popover)if(e&&n.isPlainObject(e)){e.attr||(e.attr={}),e.attr["'data-toggle'"]=t.parseBind(t.tooltip?"tooltip":"popover");if(t.tooltip||t.popoverTitle)e.attr.title=t.textBind(t.tooltip||t.popoverTitle);t.popover&&(e.attr["'data-content'"]=t.textBind(t.popover),e.attr["'data-container'"]="'body'",t.popoverDismissible&&(e.attr["'data-trigger'"]="'focus'")),e.attr["'data-placement'"]=t.parseBind(t.tooltipLocation||t.popoverLocation)}return e},addPopoverBind:function(e){var t=this;return t.tooltip&&e&&n.isPlainObject(e)&&(e.attr||(e.attr={}),e.attr["'data-toggle'"]="'popover'",e.attr.title=t.textBind(t.popover),e.attr["'data-placement'"]=t.parseBind(t.popoverLocation)),e},_getElementSelector:function(){var e=this,t=e.enclosedBind?e.getEnclosedBindId():e.getId();return"#"+t},getElement:function(){var e=this;return e._element||(e._element=n(e._getElementSelector()),e._element.length||(e._element=null)),e._element},constructor:function(){var e=this;return e._precompile(),e.callParent(arguments)},_precompile:function(){var e=this,t,n=["tpl","beforeSubTpl","subTpl","afterSubTpl"];e._template={},e._build={};for(var r=0,i=n.length;r<i;r++)t=n[r],e[t]&&e.template(t);return e},b:function(e){return n.isFunction(e)?e.bind(this)():e},init:function(){var e=this;return e.autoRender&&e.getTarget()&&(e.tpl=e.build()),e.tooltip&&require(["bootstrap.plugins/tooltip"],function(){var t=e.getElement();t&&t.tooltip(e.tooltipOptions)}),e.popover&&require(["bootstrap.plugins/tooltip","bootstrap.plugins/popover"],function(){var t=e.getElement();t&&t.popover(e.popoverOptions)}),e._registerHandler(),e.on("rendered",function(){var t=e.getElement();e.contextMenu&&!e.contextMenu._classname&&require(["Firebrick.ui/menu/ContextMenu"],function(){t.on("contextmenu",function(t){var n={_parent:e,contextMenuEvent:t};t.preventDefault(),e._contextMenu=Firebrick.create("Firebrick.ui.menu.ContextMenu",Firebrick.utils.overwrite(n,e.contextMenu))})}),e.autoFocus&&e.focus()}),e.callParent(arguments)},focus:function(){this.getElement().focus()},_registerHandler:function(e,t,r){var i=this;t=t||i.handler,r=r||i.handlerEvent,e=e||i._getElementSelector(),t&&r&&n(document).on(r,e,function(){var e=Array.prototype.slice.call(arguments);e.push(this),t.apply(i,e)})},bindings:function(){var e=this,t={attr:{},css:{}};return e.css&&(t.css[e.parseBind(e.css)]=!0),e.style&&(t.style=e.style),e.addTooltipPopoverBind(t)},template:function(t,n){var r=this;t=t||"tpl";if(!r._template[t]||n)r._template[t]=e.template(r[t]);return r._template[t]},build:function(e){var t=this;return e=e||"tpl",t._build[e]=t._template[e](t),t._build[e]},dataBind:function(){var e=this,t=Firebrick.utils.argsToArray(arguments),r,i;return t&&t.length?r=t.splice(0,1):r="bindings",i=e[r],n.isFunction(i)&&(i=i.apply(e,t)),Firebrick.ui.utils.stringify(i)},getSubTpl:function(){var e=this,t=e.build("subTpl");return e.beforeSubTpl&&(t=e.build("beforeSubTpl")+t),e.afterSubTpl&&(t+=e.build("afterSubTpl")),t},_getParent:function(e){var t=e||this,n=Object.getPrototypeOf(t);if(t._classname!==n._classname)if(t.subTpl!==n.subTpl||t.tpl!==n.tpl)return n;return this._getParent(n)},getParentTpl:function(){var t=this;return e.template(t._getParent().tpl)(t)},getParentSubTpl:function(){var t=this;return e.template(t._getParent().subTpl)(t)},cleanString:function(e){return e.replace(/\'/g,"")},parseBind:function(e){return"'"+e+"'"},textBind:function(e){return"fb.text('"+e+"')"}})});