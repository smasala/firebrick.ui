/*!
 * @author Steven Masala [me@smasala.com]
 */

define(["text!./List.html","knockout","jquery","../common/Base","../common/mixins/Items","../common/mixins/Badges"],function(e,t,n){"use strict";return t.bindingHandlers.listRenderer||(t.virtualElements.allowedBindings.listRenderer=!0,t.bindingHandlers.listRenderer={init:function(e,r){var i=t.virtualElements.childNodes(e),s;for(var o=0,u=i.length;o<u;o++)s=i[o],s instanceof window.HTMLUListElement&&n(s).attr("id",r())}}),t.bindingHandlers.listItemRenderer||(t.virtualElements.allowedBindings.listItemRenderer=!0,t.bindingHandlers.listItemRenderer={init:function(e,t,r,i){var s=n(e);s.length&&i&&i.css&&s.addClass(Firebrick.ui.utils.getValue(i.css))}}),Firebrick.define("Firebrick.ui.display.List",{extend:"Firebrick.ui.common.Base",mixins:["Firebrick.ui.common.mixins.Items","Firebrick.ui.common.mixins.Badges"],sName:"display.list",tpl:e,listType:"ul",listGroup:!1,listItemGroupClass:!0,data:null,unstyled:!1,preItemTpl:"",postItemTpl:"",linkedList:!1,virtualContainerBindings:function(){return{"if":"$data && $data.length"}},ignoreRouter:!1,collapsedCSS:"fb-ui-listitem-collapsed",preNode:!0,nodeCSSRenderer:function(e){var t={},n=e.children;return t["fb-ui-node-action"]=!0,n?(t.glyphicon=!0,n.expandable!==!1&&(t["fb-ui-list-expandable-node"]=!0)):t["fb-ui-hidden"]=!0,t},init:function(){var e=this;return e.on("rendered",function(){e._initUIEvents()}),e.callParent(arguments)},_initUIEvents:function(){var e=this,t=e.getElement(),r=n(".fb-ui-list-expandable-node",t),i=function(){return e._nodeClick(this,arguments)};r.length&&(r.on("click",i),e.on("destroy",function(){r.off("click",i)}))},_nodeClick:function(e,t){var r=this,i=n(e),s=i.closest("li.fb-ui-listitem-parent"),o=Firebrick.utils.argsToArray(t);return o.unshift("nodeClicked"),o.push(s),r.toggleCollapse(s),r.fireEvent("nodeClicked",o)},toggleCollapse:function(e){var t=this,r=n("> ul",e);r.length&&(r.is(":visible")?t.collapseNode(e):t.expandNode(e))},collapseNode:function(e){var t=this,r=n("> ul",e);r.length&&(r.hide(),t.fireEvent("nodeCollapsed",e,r),e.addClass(t.collapsedCSS))},expandNode:function(e){var t=this,r=n("> ul",e);r.length&&(r.show(),t.fireEvent("nodeExpanded",e,r),e.removeClass(t.collapsedCSS))},bindings:function(){var e=this,t=e.callParent(arguments);return e.listGroup&&(t.css["'list-group'"]=e.listGroup),e.unstyled&&(t.css["'fb-ui-list-unstyled'"]=e.unstyled),e.items&&(t.foreach="$data"),t.visible="$parent.expanded === false ? false : true",t},listItemBindings:function(){var e=this,t={css:{"'fb-ui-listitem-parent'":"$data.children ? true : false","'fb-ui-listitem-haschildren'":"$data.children ? true : false"},attr:{}};return e.listGroup&&e.listItemGroupClass&&(t.css["'list-group-item'"]=e.listItemGroupClass),t.css[e.parseBind(e.collapsedCSS)]="$data.children && $data.expandable !== false && $data.expanded === false ? true : false",t.css.divider="$data === '|' || $data.divider ? true : false",t.attr.id="$data.id || 'fb-ui-listitem-' + Firebrick.utils.uniqId()",t.listItemRenderer=!0,t},listItemTextBindings:function(){return{value:"$data.hasOwnProperty('value') ? $data.value : $data",htmlWithBinding:"$data.renderer ? $data.renderer($data, $context) : ($data.text ? $data.text : $data)",css:{"'fb-ui-listitem-text'":!0}}},listTemplateBindings:function(){var e=this;return{template:{name:e.parseBind(e._getTplId()),data:n.isArray(e.items)?"Firebrick.ui.getCmp('"+e.getId()+"').items":e.items},listRenderer:e.parseBind(e.getId())}},_getTplId:function(){return"fb-ui-tpl-"+this.getId()},childrenBindings:function(){var e=this;return{template:{name:e.parseBind(e._getTplId()),data:"$data.children"}}},listLinkBindings:function(){var e=this,t={attr:{href:"Firebrick.ui.helper.linkBuilder( $data )","'data-value'":"$data.hasOwnProperty('value') ? $data.value : $data"},value:"$data.hasOwnProperty('value') ? $data.value : $data"};return t.attr["'data-target'"]="$data.dataTarget ? $data.dataTarget : false",t.attr["'fb-ignore-router'"]="$data.hasOwnProperty( 'ignoreRouter' ) ? $data.ignoreRouter : "+e.ignoreRouter,t},listItemNodeBindings:function(){var e=this,t={css:"Firebrick.getById('"+e.getId()+"').nodeCSSRenderer( $data )"};return t}})});